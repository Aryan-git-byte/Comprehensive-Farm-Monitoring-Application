# ü§ñ AI Prompt Structure for Bulk Testing

## Complete Prompt Breakdown

When you upload a CSV and process bulk tests, here's **exactly** what prompt is sent to the AI (LLaMA 3.3 70B) for each test case.

---

## üìã Example Scenario

**CSV Input:**

```csv
id,latitude,longitude,soil_ph,nitrogen,phosphorus,potassium,crop_type,language
1,28.6139,77.2090,6.5,120,45,180,wheat,en
```

**Auto-Fetched Weather Data:**

- Temperature: 28.5¬∞C
- Humidity: 65%
- Weather: clear sky
- Wind Speed: 12.5 km/h
- Rainfall: 0mm

---

## üîπ STEP 1: Build User Query

The system first constructs a user query from your CSV data:

```
Provide farming advice based on these parameters. Location: 28.6139, 77.2090, Soil pH: 6.5, Nitrogen: 120 mg/kg, Phosphorus: 45 mg/kg, Potassium: 180 mg/kg, Temperature: 28.5¬∞C, Humidity: 65%, Weather: clear sky, Wind Speed: 12.5 km/h, Crop: wheat
```

**Components:**

- ‚úÖ Base query: "Provide farming advice based on these parameters"
- ‚úÖ Location coordinates (lat, lon)
- ‚úÖ All soil parameters from CSV
- ‚úÖ **Auto-fetched weather data** (temp, humidity, conditions, wind)
- ‚úÖ Crop type
- ‚úÖ Additional rainfall if present

---

## üîπ STEP 2: Build System Prompt

Then, the system creates a comprehensive **system prompt** that includes:

### **A. Core Role Definition**

**English Version:**

```
You are an Indian agricultural expert with perfect conversation memory. Provide practical and technical advice for summer season during afternoon.
```

**Hindi Version:**

```
‡§Ü‡§™ ‡§è‡§ï ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§™‡•Ç‡§∞‡•Ä ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Ø‡§æ‡§¶ ‡§∞‡§ñ‡§§‡•á ‡§π‡•à‡§Ç‡•§ summer ‡§ï‡•á ‡§Æ‡•å‡§∏‡§Æ ‡§Æ‡•á‡§Ç afternoon ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§î‡§∞ ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§≤‡§æ‡§π ‡§¶‡•á‡§Ç‡•§
```

### **B. Query Metadata**

```
Query Type: soil_analysis
Urgency Level: medium
Is Follow-up: No
Language: English
```

**Query Types:**

- `irrigation` - Water-related queries
- `health` - Disease/pest issues
- `nutrition` - Fertilizer/nutrient questions
- `harvest` - Harvesting advice
- `weather` - Weather-related
- `soil_analysis` - Soil parameters analysis
- `general` - General farming

**Urgency Levels:**

- `low` - Routine questions
- `medium` - Standard issues
- `high` - Problem situations
- `critical` - Emergency alerts

### **C. Conversation History**

For bulk testing, this is typically empty (new conversation per test):

```
CONVERSATION HISTORY:
(none for first query in bulk testing)
```

### **D. Farmer Profile**

Extracted from CSV or defaults:

```
FARMER PROFILE:
Experience: intermediate
Crop: wheat
Farm Size: (if provided in CSV)
Location: (if location name provided)
```

### **E. Current Sensor Readings**

If there are active sensors in the database:

```
CURRENT SENSOR READINGS:
soil_moisture: 45% (Status: normal, Location: 28.6139, 77.2090)
soil_temperature: 24¬∞C (Status: normal, Location: 28.6139, 77.2090)
```

### **F. Current Weather Conditions**

**From OpenWeather API (Auto-fetched):**

```
CURRENT WEATHER CONDITIONS:
Location Sensor Location: Temperature 28.5¬∞C, Humidity 65%, Wind Speed 12.5km/h, Pressure 1013hPa
```

### **G. Critical Alerts**

If any sensors show critical values:

```
CRITICAL ALERTS:
CRITICAL: soil_moisture showing 15% - requires immediate attention
```

### **H. Ongoing Issues**

Tracked from conversation context:

```
ONGOING ISSUES:
(none for new bulk test conversations)
```

### **I. Previous Recommendations**

From conversation history:

```
PREVIOUS RECOMMENDATIONS:
(none for new bulk test conversations)
```

---

## üîπ STEP 3: Instructions to AI

The system provides detailed instructions:

```
INSTRUCTIONS:
- Remember and reference the conversation history when relevant
- If this is a follow-up question, connect your answer to previous discussions
- Provide detailed, actionable advice based on real-time data and conversation context
- Address critical alerts with highest priority
- Consider the farmer's experience level and provide appropriate detail
- Include specific recommendations with quantities, timing, and methods
- Suggest follow-up questions or next steps when appropriate
- Respond in English language
- Use emojis to make the advice more readable and engaging
- Structure your response clearly with sections when appropriate

FORMAT YOUR RESPONSE AS:
üå± **Main Advice**: [Your detailed recommendation]
‚ö° **Immediate Actions**: [What to do right now]
üìÖ **Next Steps**: [What to plan for coming days/weeks]
‚ùì **Follow-up Questions**: [Questions to help farmer better, if any]
üîó **Related Topics**: [Other areas farmer might want to explore]
```

---

## üì® Complete Example Prompt

Here's what the AI actually receives for a single bulk test:

### **SYSTEM PROMPT:**

```
You are an Indian agricultural expert with perfect conversation memory. Provide practical and technical advice for summer season during afternoon.

Query Type: soil_analysis
Urgency Level: medium
Is Follow-up: No
Language: English

CURRENT SENSOR READINGS:
(if any sensors are active in the database)

CURRENT WEATHER CONDITIONS:
Location 28.6139, 77.2090: Temperature 28.5¬∞C, Humidity 65%, Wind Speed 12.5km/h, Pressure 1013hPa

FARMER PROFILE:
Experience: intermediate
Crop: wheat

INSTRUCTIONS:
- Remember and reference the conversation history when relevant
- If this is a follow-up question, connect your answer to previous discussions
- Provide detailed, actionable advice based on real-time data and conversation context
- Address critical alerts with highest priority
- Consider the farmer's experience level and provide appropriate detail
- Include specific recommendations with quantities, timing, and methods
- Suggest follow-up questions or next steps when appropriate
- Respond in English language
- Use emojis to make the advice more readable and engaging
- Structure your response clearly with sections when appropriate

FORMAT YOUR RESPONSE AS:
üå± **Main Advice**: [Your detailed recommendation]
‚ö° **Immediate Actions**: [What to do right now]
üìÖ **Next Steps**: [What to plan for coming days/weeks]
‚ùì **Follow-up Questions**: [Questions to help farmer better, if any]
üîó **Related Topics**: [Other areas farmer might want to explore]
```

### **USER QUERY:**

```
Provide farming advice based on these parameters. Location: 28.6139, 77.2090, Soil pH: 6.5, Nitrogen: 120 mg/kg, Phosphorus: 45 mg/kg, Potassium: 180 mg/kg, Temperature: 28.5¬∞C, Humidity: 65%, Weather: clear sky, Wind Speed: 12.5 km/h, Crop: wheat
```

---

## üéØ Key Features of the Prompt

### 1. **Context-Aware**

- Season detection (summer/monsoon/winter)
- Time of day (morning/afternoon/evening/night)
- Regional farming practices

### 2. **Data-Rich**

- Real sensor readings from database
- **Live weather from OpenWeather API**
- Soil parameters from your CSV
- Crop-specific information

### 3. **Structured Output**

- Emoji-enhanced readability
- Clear sections (Main Advice, Immediate Actions, Next Steps)
- Follow-up questions for continuous learning
- Related topics for exploration

### 4. **Safety-Focused**

- Urgency level prioritization
- Critical alert highlighting
- Farmer experience consideration

### 5. **Bilingual Support**

- English (`en`) or Hindi (`hi`)
- Culturally appropriate advice
- Regional context

---

## üîÑ Differences from Regular Chat

| Feature                  | Regular Chat                 | Bulk Testing                 |
| ------------------------ | ---------------------------- | ---------------------------- |
| **Conversation History** | ‚úÖ Full history              | ‚ùå New conversation per test |
| **User Context**         | ‚úÖ Tracked across messages   | ‚ùå One-time query            |
| **Follow-ups**           | ‚úÖ Contextual references     | ‚ùå Independent tests         |
| **Weather Data**         | ‚úÖ Fetched once per location | ‚úÖ Fetched per CSV location  |
| **Sensor Data**          | ‚úÖ Real-time from database   | ‚úÖ Real-time from database   |
| **Processing**           | üîÑ Interactive               | üìä Batch sequential          |

---

## üìä Query Type Detection

The system automatically detects query type based on keywords:

```javascript
// English & Hindi keywords
'water', 'irrigation', '‡§™‡§æ‡§®‡•Ä', '‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à'        ‚Üí irrigation
'disease', 'health', '‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä', '‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø'      ‚Üí health
'fertilizer', 'nutrition', '‡§ñ‡§æ‡§¶', '‡§™‡•ã‡§∑‡§£'       ‚Üí nutrition
'weather', 'rain', '‡§Æ‡•å‡§∏‡§Æ', '‡§¨‡§æ‡§∞‡§ø‡§∂'              ‚Üí weather
'soil', '‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä'                                ‚Üí soil_analysis
'harvest', 'crop', '‡§´‡§∏‡§≤'                       ‚Üí harvest
```

For bulk testing with soil parameters, it typically defaults to `soil_analysis`.

---

## üå§Ô∏è Weather Integration Flow

```
CSV Row ‚Üí Extract (lat, lon)
    ‚Üì
OpenWeather API Call
    ‚Üì
Fetch: temp, humidity, conditions, wind, rainfall
    ‚Üì
Merge with soil data from CSV
    ‚Üì
Build comprehensive query
    ‚Üì
Send to AI with full context
```

---

## üí° Pro Tips

### **For Better Bulk Testing Results:**

1. **Provide Accurate Coordinates**

   - Weather accuracy depends on location precision
   - Use decimal format (e.g., 28.6139)

2. **Include All Soil Parameters**

   - More data = better AI analysis
   - pH, NPK values highly valuable

3. **Specify Crop Type**

   - Enables crop-specific recommendations
   - Considers growth stages

4. **Use Custom Queries**

   - Override default query with `customQuery` field
   - Ask specific questions

5. **Test Language Variations**
   - Compare English vs Hindi responses
   - Cultural context differences

---

## üß™ Testing the Prompt

Want to see the actual prompt? Add console logging:

```typescript
// In aiService.ts, callOpenRouterAPI method
console.log("=== SYSTEM PROMPT ===");
console.log(systemPrompt);
console.log("=== USER QUERY ===");
console.log(userQuery);
```

Then check browser console while processing bulk tests!

---

## üìù Sample AI Response

Based on the prompt above, the AI might respond:

```
üå± **Main Advice**: Your wheat crop in Delhi region shows good soil pH (6.5)
and adequate nitrogen levels (120 mg/kg). The current clear weather with
moderate temperature (28.5¬∞C) and humidity (65%) is ideal for wheat growth
during this season.

‚ö° **Immediate Actions**:
- Monitor soil moisture levels - clear weather may increase irrigation needs
- Consider phosphorus supplementation (current 45 mg/kg is moderate)
- Inspect for any pest activity given the favorable weather

üìÖ **Next Steps**:
- Plan for top-dressing with nitrogen after 3-4 weeks if needed
- Increase potassium application (current 180 mg/kg is good but wheat benefits from more)
- Schedule irrigation based on soil moisture and weather forecasts

‚ùì **Follow-up Questions**:
- What growth stage is your wheat currently in?
- Have you noticed any yellowing of leaves?
- What's your current irrigation schedule?

üîó **Related Topics**:
- Wheat disease management in clear weather
- Optimal irrigation timing for wheat
- Nutrient management for higher yield
```

---

**Model**: LLaMA 3.3 70B Instruct  
**API**: OpenRouter  
**Weather Source**: OpenWeather API  
**Context**: Real-time sensors + Live weather + CSV data
